

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1.3.2. Unix shell scripting &#8212; Software Development: A Pragmatic Approach 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="1.3.3. Version control" href="vcs.html" />
    <link rel="prev" title="1.3.1. Basic Unix shell usage" href="unix.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="vcs.html" title="1.3.3. Version control"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="unix.html" title="1.3.1. Basic Unix shell usage"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Software Development: A Pragmatic Approach 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="ch1_index.html" >1. The beginning</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="unix_index.html" accesskey="U">1.3. Unix shell</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.3.2. Unix shell scripting</a><ul>
<li><a class="reference internal" href="#redirecting">1.3.2.1. Redirecting</a></li>
<li><a class="reference internal" href="#shell-scripts">1.3.2.2. Shell scripts</a><ul>
<li><a class="reference internal" href="#simple-for-loops">1.3.2.2.1. Simple for loops</a></li>
<li><a class="reference internal" href="#if-and-branches">1.3.2.2.2. if and branches</a></li>
<li><a class="reference internal" href="#storing-scripts-in-a-file">1.3.2.2.3. Storing scripts in a file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#process-handling">1.3.2.3. Process handling</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="unix.html"
                        title="previous chapter">1.3.1. Basic Unix shell usage</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="vcs.html"
                        title="next chapter">1.3.3. Version control</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/unix2.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="unix-shell-scripting">
<h1>1.3.2. Unix shell scripting<a class="headerlink" href="#unix-shell-scripting" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>Those who don&#8217;t understand Unix are condemned to reinvent it, poorly.</p>
<p class="attribution">&mdash;Henry Spencer</p>
</div></blockquote>
<div class="section" id="redirecting">
<h2>1.3.2.1. Redirecting<a class="headerlink" href="#redirecting" title="Permalink to this headline">¶</a></h2>
<p>You can always write the output of any command to a file by redirecting, i.e. using the &#8216;&gt;&#8217; character:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ awk <span class="s1">&#39;{print $1}&#39;</span> test.txt &gt; output.txt
</pre></div>
</div>
<p>This will create a file called output.txt, overwriting any previous contents, with the output of the &#8216;awk&#8217; command.</p>
<p>You can also append to the end of an existing file, by using &#8216;&gt;&gt;&#8217;:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ awk <span class="s1">&#39;{print $1}&#39;</span> test.txt &gt;&gt; output.txt
</pre></div>
</div>
<p>Redirecting will allow us to simplify writing our own software. For example, it might not be necessary to open a file for writing in Python, so instead of this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
</pre></div>
</div>
<p>...we can simply write this in Python:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">print</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
<p>...and then run it like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ python my_file.py &gt; test.txt
</pre></div>
</div>
<p>This has the added flexibility that we don&#8217;t have to hard code the output file name.</p>
<p>If necessary, you can also discard the output by redirecting it to the special file /dev/null, which has the sole purpose of consuming and discarding all its input:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ python my_file.py &gt; /dev/null
</pre></div>
</div>
<p><em>Exercise</em>: rewrite your program that generates the 10,000 functions file to write to standard output.</p>
<p>If you have a program that reads from standard input (stdin), you can have it read a file with a redirection:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ python script.py &lt; myfile.txt
</pre></div>
</div>
</div>
<div class="section" id="shell-scripts">
<h2>1.3.2.2. Shell scripts<a class="headerlink" href="#shell-scripts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="simple-for-loops">
<h3>1.3.2.2.1. Simple for loops<a class="headerlink" href="#simple-for-loops" title="Permalink to this headline">¶</a></h3>
<p>In most Unix shells including bash you can define for loops. For example, let&#8217;s say you wanted to run your number generation program three times, and store the output to different files:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="k">for</span> i in <span class="m">1</span> <span class="m">2</span> <span class="m">3</span><span class="p">;</span> <span class="k">do</span> python gen.py &gt; functions_<span class="si">${</span><span class="nv">i</span><span class="si">}</span>.txt <span class="p">;</span> <span class="k">done</span>
</pre></div>
</div>
<p>This will generate three files named functions_1.txt, functions_2.txt and functions_3.txt.</p>
<p>If we wanted to generate a hundred files, typing in the number would get tedious. We can use &#8220;seq&#8221; instead:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> <span class="m">100</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span> python gen.py &gt; functions_<span class="si">${</span><span class="nv">i</span><span class="si">}</span>.txt <span class="p">;</span> <span class="k">done</span>
</pre></div>
</div>
<p>This will generate a hundred files. The notation $(...) allows capturing the output of a command within another command. By using curly braces ({}) around the &#8216;i&#8217; variable we ensure the variable name gets correctly understood by the shell and not confused with the file name template.</p>
</div>
<div class="section" id="if-and-branches">
<h3>1.3.2.2.2. if and branches<a class="headerlink" href="#if-and-branches" title="Permalink to this headline">¶</a></h3>
<p>The shell built-in command &#8220;if&#8221; allows branching. There are other built-ins for comparing values against each other. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ grep -q <span class="m">2345</span> test.txt <span class="p">;</span> <span class="nv">return_value</span><span class="o">=</span><span class="nv">$?</span><span class="p">;</span> <span class="k">if</span> <span class="o">[</span> <span class="nv">$return_value</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s2">&quot;found&quot;</span><span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> <span class="s2">&quot;not found&quot;</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</div>
<p>This command will output &#8220;found&#8221; if the string was found in the input file, and &#8220;not found&#8221; otherwise. (The &#8220;-q&#8221; switch to grep suppresses output.)</p>
</div>
<div class="section" id="storing-scripts-in-a-file">
<h3>1.3.2.2.3. Storing scripts in a file<a class="headerlink" href="#storing-scripts-in-a-file" title="Permalink to this headline">¶</a></h3>
<p>It&#8217;s often practical to store scripts to a file. Here&#8217;s the previous example stored in a file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

grep -q <span class="m">2345</span> test.txt
<span class="nv">return_value</span><span class="o">=</span><span class="nv">$?</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$return_value</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;found&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;not found&quot;</span>
<span class="k">fi</span>
</pre></div>
</div>
<p>The script behaves similarly as the one-liner, but the script has one more line: it starts with &#8220;#!/bin/bash&#8221;. This is also called shebang, a character sequence at the beginning of a script indicating which tool should be used to interpret the script (in this case bash).</p>
<p>You can store the above in a file, and then execute it by passing it to bash explicitly:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ bash ./test.sh
found
</pre></div>
</div>
<p>Or you can simply make it executable, in which case it can be directly interpreted using bash:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chmod +x test.sh
$ ./test.sh
</pre></div>
</div>
<p>(The command &#8220;chmod&#8221; modifies the access rights to a file, and passing it &#8220;+x&#8221; means the file is allowed to be executed.)</p>
</div>
</div>
<div class="section" id="process-handling">
<h2>1.3.2.3. Process handling<a class="headerlink" href="#process-handling" title="Permalink to this headline">¶</a></h2>
<p>Process handling refers to managing how and when programs (processes) start and end.</p>
<p>Typically, unless overridden by the program, hitting ctrl+c sends SIGTERM (signal to terminate) to the current program. SIGTERM is a signal that tells a program it should terminate, and by default will kill the program. However programs are allowed to install a <em>signal handler</em> for SIGTERM so they can perform any necessary cleanup before terminating, for example closing and saving any files that have been modified.</p>
<p>Another useful key combination is ctrl+z which stops the program execution and puts it in the background. This means that you can start a process, for example &#8220;less test.txt&#8221;, then exit the program but keep it running by pressing ctrl+z which will drop you back to the shell. Let&#8217;s go through an example usage:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ cp -i big_file.tgz /mnt
^Z
<span class="o">[</span><span class="m">1</span><span class="o">]</span>+  Stopped                 cp -i big_file.tgz /mnt
$ <span class="nb">bg</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span>+ cp -i big_file.tgz /mnt <span class="p">&amp;</span>
$ ls
Makefile  dep.rst   ex_js2.rst
$
<span class="o">[</span><span class="m">1</span><span class="o">]</span>+  Done                    cp -i big_file.tgz /mnt
</pre></div>
</td></tr></table></div>
<p>Let&#8217;s assume we have a very large file we want to copy somewhere. Copying large files can take time, and cp by default doesn&#8217;t output anything while copying. We start the copy on line 1.</p>
<p>After waiting for some time, we get bored and want to do something else so we press ctrl+z. This is shown in the terminal with ^Z (line 2). Pressing this key combination will tell us that the copy command has been stopped (line 3), and drops us back in our shell (line 4).</p>
<p>We then issue the command &#8220;bg&#8221; which means the previous command should run in the <em>background</em>, meaning it can run but should not prevent us from using the shell. Issuing this command tells us on line 5 that the copy command continues to run again, pointed out by the &amp; sign at the end of the command.</p>
<p>On line 6 we can then do what we want, e.g. run &#8220;ls&#8221;.</p>
<p>On line 7, we have the prompt again and wait for some time, until we expect the copy command to have finished. We can check if this is indeed the case by hitting enter (doing nothing). Bash uses this opportunity to tell us that the copy operation indeed has finished (line 9).</p>
<p>If you&#8217;re running a command and you want to start it on the background right away, you can add the &amp; sign to the end of the command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cp -i big_file.tgz /mnt <span class="p">&amp;</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">23904</span>
$
</pre></div>
</div>
<p>If you have a command running in the background but want to run it on the foreground again, run &#8220;fg&#8221;:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cp -i big_file.tgz /mnt <span class="p">&amp;</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">23904</span>
$ <span class="nb">fg</span>
cp -i big_file.tgz /mnt
$
</pre></div>
</div>
<p>If you want to see which commands you have running in the background in the current terminal, run &#8220;ps&#8221;:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ps
  PID TTY          TIME CMD
 <span class="m">5898</span> pts/8    <span class="m">00</span>:00:01 bash
<span class="m">23904</span> pts/8    <span class="m">00</span>:00:00 cp
<span class="m">23905</span> pts/8    <span class="m">00</span>:00:00 ps
</pre></div>
</div>
<p>If you want to send a SIGTERM signal to another process than what&#8217;s currently running in the foreground, you can use the &#8220;kill&#8221; command with the PID (process ID) of the process you want to kill, for example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cp -i big_file.tgz /mnt <span class="p">&amp;</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">23904</span>
$ ps
  PID TTY          TIME CMD
 <span class="m">5898</span> pts/8    <span class="m">00</span>:00:01 bash
<span class="m">23904</span> pts/8    <span class="m">00</span>:00:00 cp
<span class="m">23905</span> pts/8    <span class="m">00</span>:00:00 ps
$ <span class="nb">kill</span> <span class="m">23904</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span>+  Terminated              cp -i big_file.tgz /mnt
$
</pre></div>
</div>
<p>Note that bash tells you the PID of the newly started process when you start it on the background using &amp;.</p>
<p>Because a program can install a signal handler for SIGTERM, it&#8217;s possible that sending SIGTERM to a program won&#8217;t kill it. To force kill a program you need to send the signal SIGKILL (signal 9 as can be seen from the signal man page at &#8220;man 7 signal&#8221;):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cp -i big_file.tgz /mnt <span class="p">&amp;</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">23937</span>
$ <span class="nb">kill</span> -9 <span class="m">23937</span>
$
<span class="o">[</span><span class="m">1</span><span class="o">]</span>+  Killed                  cp -i big_file.tgz /mnt
$
</pre></div>
</div>
<p><em>Exercise</em>: Start &#8220;less&#8221; to browse a file, hit ctrl+z to move it to the background, then run &#8220;fg&#8221; to bring it to foreground again.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="vcs.html" title="1.3.3. Version control"
             >next</a> |</li>
        <li class="right" >
          <a href="unix.html" title="1.3.1. Basic Unix shell usage"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Software Development: A Pragmatic Approach 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="ch1_index.html" >1. The beginning</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="unix_index.html" >1.3. Unix shell</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Antti Salonen.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.
    </div>
  </body>
</html>